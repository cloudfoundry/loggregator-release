<%
  etcd_machines = []
  if_p("etcd.machines") do |machines|
    etcd_machines = machines
  end

  if_p("loggregator.etcd.machines") do |machines|
    etcd_machines = machines
  end
%>
{
  "Index": <%= spec.index %>,
  "Job": "<%= name %>",
  "Zone": "<%= p("metron_agent.zone") %>",
  "Deployment": "<%= p("metron_agent.deployment") %>",

  "EtcdUrls": [<%= etcd_machines.map{|addr| "\"http://#{addr}:4001\""}.join(",")%>],
  "EtcdMaxConcurrentRequests": <%= p("etcd.maxconcurrentrequests") %>,

  "SharedSecret": "<%= p("loggregator_endpoint.shared_secret") %>",

  "LegacyIncomingMessagesPort": <%= p("metron_agent.incoming_port") %>,
  "DropsondeIncomingMessagesPort": <%= p("metron_agent.dropsonde_incoming_port") %>,

  "EtcdQueryIntervalMilliseconds": <%= p("metron_agent.etcd_query_interval_milliseconds") %>,

  "LoggregatorDropsondePort": <%= p("loggregator.dropsonde_incoming_port") %>

  <% if_p("syslog_daemon_config") do |_| %>
  , "Syslog": "vcap.metron_agent"
  <% end %>
}
