. ./loggregator/src/exiter.ps1

$ErrorActionPreference = "Stop";
trap { $host.SetShouldExit(1) }

$pkg_name="metron"
$env:GOROOT="C:\var\vcap\packages\golang1.7-windows\go"
$env:GOPATH="${PWD}\loggregator"
$env:PATH="${env:GOROOT}\bin;${env:PATH}"

$BOSH_INSTALL_TARGET = Resolve-Path $env:BOSH_INSTALL_TARGET

go build -o "${BOSH_INSTALL_TARGET}\${pkg_name}.exe" "${pkg_name}"
if($LASTEXITCODE -ne 0)
{
    Write-Error "Error compiling: ${pkg_name}"
}

Exit 0
